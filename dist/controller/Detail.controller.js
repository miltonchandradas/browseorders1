"use strict";sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/m/library"],function(e,t,i,o){"use strict";var r=o.URLHelper;function a(e,t){var i=t.getObject().Quantity*t.getObject().UnitPrice;return e+i}return e.extend("sap.ui.demo.orderbrowser.controller.Detail",{formatter:i,onInit:function e(){this._aValidKeys=["shipping","processor"];var i=new t({busy:false,delay:0,lineItemListTitle:this.getResourceBundle().getText("detailLineItemTableHeading"),currency:"EUR",totalOrderAmount:0,selectedTab:""});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(i,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this))},onSendEmailPress:function e(){var t=this.getModel("detailView");r.triggerEmail(null,t.getProperty("/shareSendEmailSubject"),t.getProperty("/shareSendEmailMessage"))},onListUpdateFinished:function e(t){var i,o=0,r=t.getParameter("total"),s=this.getModel("detailView"),n=t.getSource().getBinding("items"),l;if(n.isLengthFinal()){if(r){i=this.getResourceBundle().getText("detailLineItemTableHeadingCount",[r])}else{i=this.getResourceBundle().getText("detailLineItemTableHeading")}s.setProperty("/lineItemListTitle",i);l=n.getContexts();o=l.reduce(a,0);s.setProperty("/totalOrderAmount",o)}},_onObjectMatched:function e(t){var i=t.getParameter("arguments");this._sObjectId=i.objectId;if(this.getModel("appView").getProperty("/layout")!=="MidColumnFullScreen"){this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded")}this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("Orders",{OrderID:this._sObjectId});this._bindView("/"+e)}.bind(this));var o=i["?query"];if(o&&this._aValidKeys.indexOf(o.tab)>=0){this.getView().getModel("detailView").setProperty("/selectedTab",o.tab);this.getRouter().getTargets().display(o.tab)}else{this.getRouter().navTo("object",{objectId:this._sObjectId,query:{tab:"shipping"}},true)}},_bindView:function e(t){var i=this.getModel("detailView");i.setProperty("/busy",false);this.getView().bindElement({path:t,parameters:{expand:"Customer,Order_Details/Product,Employee"},events:{change:this._onBindingChange.bind(this),dataRequested:function e(){i.setProperty("/busy",true)},dataReceived:function e(){i.setProperty("/busy",false)}}})},_onBindingChange:function e(){var t=this.getView(),i=t.getElementBinding();if(!i.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}var o=i.getPath(),r=this.getResourceBundle(),a=t.getModel().getObject(o),s=a.OrderID,n=a.OrderID,l=this.getModel("detailView");this.getOwnerComponent().oListSelector.selectAListItem(o);l.setProperty("/shareSendEmailSubject",r.getText("shareSendEmailObjectSubject",[s]));l.setProperty("/shareSendEmailMessage",r.getText("shareSendEmailObjectMessage",[n,s,location.href,a.ShipName,a.EmployeeID,a.CustomerID]))},_onMetadataLoaded:function e(){var t=this.getView().getBusyIndicatorDelay(),i=this.getModel("detailView"),o=this.byId("lineItemsList"),r=o.getBusyIndicatorDelay();i.setProperty("/delay",0);i.setProperty("/lineItemTableDelay",0);o.attachEventOnce("updateFinished",function(){i.setProperty("/lineItemTableDelay",r)});i.setProperty("/busy",true);i.setProperty("/delay",t)},onTabSelect:function e(t){var i=t.getParameter("selectedKey");this.getRouter().navTo("object",{objectId:this._sObjectId,query:{tab:i}},true)},_onHandleTelephonePress:function e(t){var i=t.getSource().getText();r.triggerTel(i)},onCloseDetailPress:function e(){this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",false);this.getOwnerComponent().oListSelector.clearMasterListSelection();this.getRouter().navTo("master")},toggleFullScreen:function e(){var t=this.getModel("appView").getProperty("/actionButtonsInfo/midColumn/fullScreen");this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",!t);if(!t){this.getModel("appView").setProperty("/previousLayout",this.getModel("appView").getProperty("/layout"));this.getModel("appView").setProperty("/layout","MidColumnFullScreen")}else{this.getModel("appView").setProperty("/layout",this.getModel("appView").getProperty("/previousLayout"))}}})});